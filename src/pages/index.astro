---
import Layout from "../layouts/Layout.astro";
import BookmarksList from "../components/BookmarksList";
import ChapterCard from "../components/ChapterCard";
import MangaIntro from "../components/MangaIntro.astro";
import AboutSection from "../components/AboutSection.astro";
import FaqSection from "../components/FaqSection.astro";
import HomeHeader from "../components/HomeHeader.astro";
import SeoSchema from "../components/SeoSchema.astro";
import { getChapters, getManga } from "../data/manga";
import { siteConfig } from "../data/site-config";
import { generateWebsiteSchema, generateBookSchema } from "../utils/seo";
import AnnouncementBar from "../components/AnnouncementBar.astro";

// Preload and optimize data fetching
const chapters = await getChapters();
const manga = getManga();
const latestChapters = chapters.slice(-10).reverse();

// SEO metadata
const pageTitle = `${siteConfig.title} - Read ${siteConfig.title} Manga Online`;
const pageDescription = `Read ${siteConfig.title} manga online for free. ${siteConfig.description}`;

// Generate structured data
const schemas = [
  generateWebsiteSchema(
    siteConfig.title,
    siteConfig.description,
    Astro.url.href
  ),
  generateBookSchema(
    manga.title,
    manga.description,
    siteConfig.author,
    siteConfig.name,
    manga.chapters.length,
    manga.tags.map((tag) => tag.name)
  ),
];
---

<Layout title={pageTitle} description={pageDescription}>
  <SeoSchema schemas={schemas} />

  <div class="max-w-6xl mx-auto px-4">
    <HomeHeader />

    <MangaIntro />

    <section class="grid lg:grid-cols-3 gap-8 mb-12">
      <!-- Bookmarks Section - Shows first on mobile -->
      <div class="lg:col-span-1 order-1 lg:order-2">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 sticky top-20">
          <h2 class="text-2xl font-bold mb-6">Bookmarks</h2>
          <BookmarksList client:idle />
        </div>
      </div>

      <!-- Latest Chapters & Navigation -->
      <div class="lg:col-span-2 order-2 lg:order-1">
        <section class="bg-white dark:bg-gray-800 rounded-lg p-6 mb-8">
          <div
            class="flex flex-col md:flex-row items-center justify-between mb-6"
          >
            <h2 class="text-2xl font-bold">Latest Chapters</h2>
            <div class="flex gap-4">
              <a
                href={`/reader/${chapters[0].id}`}
                class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors"
                aria-label={`Start reading ${siteConfig.title} from the beginning`}
              >
                Start Reading
              </a>
              <a
                href="/chapters"
                class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors"
                aria-label="View all chapters"
              >
                All Chapters
              </a>
            </div>
          </div>
          <div class="space-y-3">
            {
              latestChapters.map((chapter) => (
                <ChapterCard client:visible chapter={chapter} />
              ))
            }
          </div>
        </section>

        <section class="bg-white dark:bg-gray-800 rounded-lg p-6 mb-8">
          <AboutSection />
        </section>

        <section class="bg-white dark:bg-gray-800 rounded-lg p-6">
          <FaqSection />
        </section>
      </div>
    </section>
  </div>
</Layout>
